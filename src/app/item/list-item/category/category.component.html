<div class="card shadow mb-4">
  <!-- Card Header - Dropdown -->
  <div class="card-header bg-gradient-light py-0 d-flex flex-row align-items-center">
    <div class="col-lg-11 col-md-11">
      <a style="text-decoration: none" [href]="'#collapseCategory'+id" class="d-block py-3" data-toggle="collapse" role="button" aria-expanded="true">
        <h5 class="m-0 font-weight-bold font-italic text-gray-900">{{ name }}</h5>
      </a>
    </div>

    <!-- Dropdown Category -->
    <div class="dropdown no-arrow">
      <!-- Bouton menu animé -->
      <a class="dropdown-toggle" href="#" role="button" [id]="'dropdownCategory'+id" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-800"></i>
      </a>
      <!-- Menu annimé -->
      <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" [attr.aria-labelledby]="'dropdownCategory'+id">
        <div class="dropdown-header">{{ name }}</div>
        <a class="dropdown-item" href="#">Ajouter un objet</a>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#addCategoryModal'+id" href="#">
          Ajouter une catégorie
        </a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#renameCategoryModal'+id" href="#">
          Renommer <span class="font-weight-bolder">{{ name }}</span>
        </a>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#deleteCategoryModal'+id" href="#">
          Supprimer <span class="font-weight-bolder">{{ name }}</span>
        </a>
      </div>
    </div>
  </div>
  <!-- Category Body -->
  <!-- <div *ngIf="categories !== null && categories.length !== 0" class="collapse show" [id]="'collapseCategory'+id">-->
  <div [ngClass]="{'show': id === null}" class="collapse" [id]="'collapseCategory'+id">
    <div class="card-body">
      <div class="card-deck" *ngIf="items != null && items.length > 0">
        <div *ngFor="let item of items">
          <div class="card mb-3">
            <div class="card-header bg-gradient-light text-center">
              <a routerLink="/items/{{ item.id }}">
                <small class="text-primary font-italic font-weight-bold">{{ item.name  }}</small>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="categories != null && categories.length > 0">
        <app-category *ngFor="let category of categories"
                      [id]="category.id"
                      [name]="category.name"
                      [categories]="category.categories"
                      [items]="category.items"></app-category>
      </div>
    </div>
  </div>
</div>

<!-- *************************************************************** MODALS **************************************** -->
<!-- Add category Modal-->
<div class="modal fade" [id]="'addCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Ajouter une categorie à <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="createCategoryForm">
      <div class="modal-body text-center">
          <div class="form-group">
           <input class="form-control form-control-user" formControlName="name" id="nameCreate" type="text"
                  placeholder="Saisir le nom de la nouvelle catégorie" [maxlength]="maxlength">
          </div>
          <div class="form-group">
            <select  class="form-control custom-select" formControlName="type" id="type">
              <option value="" disabled hidden>Choisir le type de catégorie à ajouter</option>
              <option value="C">Catégorie de type enfant</option>
              <option value="P">Catégorie de type parent</option>
            </select>
          </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
        <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitCreateCategoryForm()" [disabled]="!createCategoryForm.valid">Ajouter</button>
      </div>
      </form>
    </div>
  </div>
</div>



<!-- rename category Modal-->
<div class="modal fade" [id]="'renameCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel2">
          Renommer <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="renameCategoryForm">
        <div class="modal-body text-center">
          <div class="form-group">
            <input class="form-control form-control-user" formControlName="name" id="nameRename" type="text"
                   placeholder="Saisir le nouveau nom de '{{ name }}'" [maxlength]="maxlength">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitRenameCategoryForm()" [disabled]="!renameCategoryForm.valid">Renommer</button>
        </div>
      </form>
    </div>
  </div>
</div>



<!-- delete category Modal-->
<div class="modal fade" [id]="'deleteCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel3">
          Renommer <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
        <div class="modal-body text-center">
         Les objets et sous-catégories contenu dans
          <span class="font-weight-bolder">{{ name }}</span>
          seront transférés dans sa catégorie parent.
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onDeleteCategory()">Supprimer</button>
        </div>
    </div>
  </div>
</div>
