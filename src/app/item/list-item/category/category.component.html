<div class="card shadow m-1 mb-2 mt-2">
  <!-- Card Header - Dropdown -->
  <div class="card-header bg-gradient-light py-0 d-flex flex-row align-items-center">
    <div class="col-lg-11 col-md-11 px-0">
      <a style="text-decoration: none" [href]="'#collapseCategory'+id" class="d-block pt-2" data-toggle="collapse" role="button" aria-expanded="true">
        <h5 class="font-weight-bold font-italic text-gray-800 text-truncate">{{ name }}</h5>
      </a>
    </div>

    <!-- Dropdown Category -->
    <div class="dropdown no-arrow">
      <!-- Bouton menu animé -->
      <a class="dropdown-toggle" href="#" role="button" [id]="'dropdownCategory'+id" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-800"></i>
      </a>
      <!-- Menu annimé -->
      <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" [attr.aria-labelledby]="'dropdownCategory'+id">
        <div class="dropdown-header">{{ name }}</div>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#addItemModal'+id" href="#">
          Ajouter un objet
        </a>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#addCategoryModal'+id" href="#">
          Ajouter une catégorie
        </a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#renameCategoryModal'+id" href="#">
          Renommer <span class="font-weight-bolder">{{ name }}</span>
        </a>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#moveCategoryModal'+id" href="#">
          Déplacer <span class="font-weight-bolder">{{ name }}</span>
        </a>
        <a class="dropdown-item" data-toggle="modal" [attr.data-target]="'#deleteCategoryModal'+id" href="#">
          Supprimer <span class="font-weight-bolder">{{ name }}</span>
        </a>
      </div>
    </div>
  </div>
  <!-- Category Body -->
   <div class="collapse" [id]="'collapseCategory'+id">
    <div class="card-body bg-light py-1">
      <div class="card-deck" *ngIf="items != null && items.length > 0">
        <app-item *ngFor="let item of items"
                  [id]="item.id"
                  [name]="item.name"
                  [description]="item.description"
                  [urlItem]="item.urlItem"
                  [subItems]="item.subItems">
        </app-item>
      </div>
      <hr class="m-2" *ngIf="items != null && items.length > 0 && categories != null && categories.length > 0" />
      <div class="card-deck" *ngIf="categories != null && categories.length > 0">
        <app-category *ngFor="let category of categories"
                      [id]="category.id"
                      [name]="category.name"
                      [categories]="category.categories"
                      [items]="category.items">
        </app-category>
      </div>
    </div>
  </div>
</div>

<!-- *************************************************************** MODALS **************************************** -->
<!-- Add category Modal-->
<div class="modal fade" [id]="'addCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Ajouter une categorie à <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="createCategoryForm">
      <div class="modal-body text-center">
          <div class="form-group">
           <input class="form-control form-control-user" formControlName="name" id="nameCreate" type="text"
                  placeholder="Saisir le nom de la nouvelle catégorie" [maxlength]="maxlengthCategoryName">
          </div>
          <div class="form-group">
            <select  class="form-control custom-select" formControlName="type" id="type">
              <option value="" disabled hidden>Choisir le type de catégorie à ajouter</option>
              <option value="C">Catégorie de type enfant</option>
              <option value="P">Catégorie de type parent</option>
            </select>
          </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
        <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitCreateCategoryForm()" [disabled]="!createCategoryForm.valid">Ajouter la catégorie</button>
      </div>
      </form>
    </div>
  </div>
</div>



<!-- rename category Modal-->
<div class="modal fade" [id]="'renameCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel2">
          Renommer <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="renameCategoryForm">
        <div class="modal-body text-center">
          <div class="form-group">
            <input class="form-control form-control-user" formControlName="name" id="nameRename" type="text"
                   placeholder="Saisir le nouveau nom de '{{ name }}'" [maxlength]="maxlengthCategoryName">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitRenameCategoryForm()" [disabled]="!renameCategoryForm.valid">Renommer</button>
        </div>
      </form>
    </div>
  </div>
</div>



<!-- delete category Modal-->
<div class="modal fade" [id]="'deleteCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel3">
          Supprimer <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
        <div class="modal-body text-center">
         Les objets et sous-catégories contenu dans
          <span class="font-weight-bolder">{{ name }}</span>
          seront transférés dans sa catégorie parent.
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onDeleteCategory()">Supprimer</button>
        </div>
    </div>
  </div>
</div>



<!-- Add item Modal-->
<div class="modal fade" [id]="'addItemModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel4">
          Ajouter un nouvel objet dans <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="createItemForm">
        <div class="modal-body text-center">
          <div class="form-group">
            <input class="form-control form-control-user" formControlName="name" id="nameCreateItem" type="text"
                   placeholder="Saisir le nom du nouvel objet" [maxlength]="maxlengthItemName" />
          </div>
          <div class="form-group">
            <input class="form-control form-control-user" formControlName="description" id="descriptionCreateItem" type="text"
                   placeholder="Saisir une description de l'objet" [maxlength]="maxlengthItemDescription" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitCreateItemForm()" [disabled]="!createItemForm.valid">Ajouter un nouvel objet</button>
        </div>
      </form>
    </div>
  </div>
</div>



<!-- Move Category Modal-->
<div class="modal fade" [id]="'moveCategoryModal'+id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel5">
          Déplacer <span class="font-weight-bolder">{{ name }}</span> ?
        </h5>
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form [formGroup]="moveCategoryForm">
        <div class="modal-body text-center">
          <div class="form-group">
            <select class="form-control custom-select text-muted" formControlName="categoryMove" id="categoryMove">
              <option value="" disabled="disabled" hidden="hidden">Choisir la catégorie de destination</option>
              <option *ngFor="let pCategory of getFullCategoriesInOneArray()" [value]="pCategory.id">{{ pCategory.name }}</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
          <button class="btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitMoveCategoryForm()" [disabled]="!moveCategoryForm.valid">Déplacer {{ name }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
