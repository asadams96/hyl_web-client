<div class="modal fade" (focus)="checkIfModalCreateSubItemAlreadyUsed()" [id]="'addSubItemModal'+item.id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel4">
                    Ajouter un exemplaire à <span class="font-weight-bolder">{{ item.name }}</span> ?
                </h5>
                <button (click)="onCancelCreateSubItemForm()" class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <form [id]="'createSubItemForm'+item.id" [formGroup]="createSubItemForm">
                <div class="modal-body text-center pt-2 pb-1">
                    <div [ngClass]="{'invisible': createSubItemForm.valid }" class="text-left mb-2">
                        <div *ngIf="createSubItemForm.controls.reference.errors?.minlength" class="alert-danger">
                            <small>La référence doit faire au moins {{ minlengthSubItemReference }} caractères</small>
                        </div>
                        <div *ngIf="createSubItemForm.controls.reference.errors?.checkatomicref" class="alert-danger">
                            <small>Vous utilisez déjà cette référence pour un de vos objets</small>
                        </div>
                        <div *ngIf="createSubItemForm.controls.reference.errors?.failatomicref" class="alert-danger">
                            <small>Une erreur de communication s'est produite</small>
                        </div>
                        <div *ngIf="createSubItemForm.controls.reference.errors === null"
                             [ngClass]="{'invisible': createSubItemForm.valid}">
                            <small>.</small>
                        </div>
                    </div>
                    <div class="form-group pb-2">
                        <input class="form-control form-control-user" formControlName="reference" id="reference" type="text"
                               placeholder="Saisir une référence pour le nouvel exemplaire" [maxlength]="maxlengthSubItemReference">
                    </div>
                    <div class="form-group">
                        <input class="d-none" #input multiple="multiple" formControlName="files" type="file" id="files" accept="image/*" (change)="handleFileInput($event.target.files)">
                        <div class="card-deck pt-2 mx-1 justify-content-around" *ngIf="imgPreview !== null && imgPreview.length > 0">
                            <div class="pt-2 pb-0" *ngFor="let img of imgPreview; let i = index">
                                <span id="img-helper" class="align-middle d-inline-block h-100"></span>
                                <figure class="p-0 m-0 d-inline-block align-middle">
                                    <img #htmlImageElement (load)="onLoadImg(htmlImageElement, img)" class="d-none m-auto" [src]="img">
                                    <figcaption style="justify-content: space-between; display: flex" class="text-left justify-content-between align-content-between">
                                        <small>
                                            {{filesToUpload[i].name.substring(0, filesToUpload[i].name.length > 16 ? 16 : filesToUpload[i].name.length)}}
                                            {{filesToUpload[i].name.length > 16 ? '...' : ''}}
                                        </small>
                                        <small>
                                            {{(filesToUpload[i].size/1024 | number: '1.0-1') + ' Ko'}}
                                        </small>
                                    </figcaption>
                                </figure>
                            </div>
                        </div>
                    </div>
                    <div  *ngIf="formatUnsuppErrFile"  class="text-left">
                        <p class="m-0 ml-1 alert-danger"><small>
                            Le format <span class="font-weight-bolder text-truncate">{{ formatUnsuppErrFile.type }}</span> de
                            <span class="font-weight-bolder text-truncate">{{ formatUnsuppErrFile.name }}</span> n'est pas pris en charge.
                        </small></p>
                        <p class="m-0 ml-1 alert-danger"><small>
                            Format supporté: <span class="font-weight-bolder">{{ formatSupportedStr }}</span>
                        </small></p>
                    </div>
                    <div  *ngIf="sizeMaxErrFile"  class="text-left">
                        <p class="m-0 ml-1 alert-danger"><small>
                            Le poids de <span class="font-weight-bolder text-truncate">{{ sizeMaxErrFile.name }}</span> de
                            <span class="font-weight-bolder">{{ sizeMaxErrFile.size/1024 | number: '1.0-1' }} Ko</span> fait dépasser la limite
                            autorisée de <span class="font-weight-bolder">{{ filesSizeMax/1024/1024 | number: '1.0-0' }} Mo</span> par exemplaire d'item.
                        </small></p>
                        <p class="m-0 ml-1 alert-danger"><small>
                            Poids restant: <span class="font-weight-bolder">{{ (filesSizeMax - getFilesSize()) / 1024 | number: '1.0-1' }} Ko</span>
                        </small></p>
                    </div>
                </div>
                <div class="ml-3 m-0 p-0">
                    <small class="text-success">
                        Poids des images <i class="fas fa-long-arrow-alt-right"></i> {{getFilesSize()/1024/1024 | number: '1.0-2'}} / {{filesSizeMax/(1024*1024)}} Mo
                    </small>
                </div>
                <div class="modal-footer justify-content-between">
                    <div>
                        <button class="btn btn-info" (click)="input.click()">
                            <i style="font-size: 20px" class="fas fa-file-upload"></i> Ajouter une image
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-danger" type="button" data-dismiss="modal" (click)="onCancelCreateSubItemForm()">Annuler</button>
                        <button class="ml-2 btn btn-primary" type="submit" data-dismiss="modal" (click)="onSubmitCreateSubItemForm()" [disabled]="!createSubItemForm.valid">Ajouter l'exemplaire</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
